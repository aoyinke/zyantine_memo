# 记忆系统测试文件设计

## 测试目标
观察记忆系统从对话中记忆的信息，分析其存储行为，找出可能的优化点。

## 测试文件结构
```python
# tests/test_memory_system.py

import json
import time
from zyantine_genisis.memory.memory_store import ZyantineMemorySystem

def test_memory_system():
    # 初始化记忆系统
    memory_system = ZyantineMemorySystem(user_id="test_user", session_id="test_session")
    
    # 测试场景1: 日常闲聊对话
    print("\n=== 测试场景1: 日常闲聊对话 ===")
    test_small_talk(memory_system)
    
    # 测试场景2: 重要信息对话
    print("\n=== 测试场景2: 重要信息对话 ===")
    test_important_info(memory_system)
    
    # 测试场景3: 重复信息对话
    print("\n=== 测试场景3: 重复信息对话 ===")
    test_repeated_info(memory_system)
    
    # 测试场景4: 混合信息对话
    print("\n=== 测试场景4: 混合信息对话 ===")
    test_mixed_info(memory_system)
    
    # 测试场景5: 无意义信息对话
    print("\n=== 测试场景5: 无意义信息对话 ===")
    test_meaningless_info(memory_system)
    
    # 分析记忆存储结果
    print("\n=== 分析记忆存储结果 ===")
    analyze_memory_results(memory_system)

def test_small_talk(memory_system):
    """测试日常闲聊对话"""
    conversations = [
        "你好，今天天气怎么样？",
        "还不错，有点热。",
        "是的，夏天到了。",
        "你最近在忙什么？",
        "没什么特别的，就是工作。"
    ]
    
    for i, conv in enumerate(conversations):
        memory_id = memory_system.add_memory(
            content=conv,
            memory_type="conversation",
            tags=["闲聊", "日常"]
        )
        print(f"添加闲聊对话 {i+1}: {conv[:30]}... -> ID: {memory_id}")
        time.sleep(0.1)  # 避免ID冲突

def test_important_info(memory_system):
    """测试重要信息对话"""
    conversations = [
        "我明天要参加一个重要的会议，时间是上午9点。",
        "会议地点在公司总部的大会议室。",
        "我需要准备一份详细的项目报告。",
        "这个项目的预算是100万，期限是3个月。",
        "项目的主要负责人是张经理。"
    ]
    
    for i, conv in enumerate(conversations):
        memory_id = memory_system.add_memory(
            content=conv,
            memory_type="conversation",
            tags=["重要", "工作"]
        )
        print(f"添加重要信息 {i+1}: {conv[:30]}... -> ID: {memory_id}")
        time.sleep(0.1)

def test_repeated_info(memory_system):
    """测试重复信息对话"""
    conversations = [
        "今天是星期一。",
        "今天是星期一。",
        "今天是星期一，天气晴朗。",
        "今天是星期一。",
        "今天是星期一，我要去上班。"
    ]
    
    for i, conv in enumerate(conversations):
        memory_id = memory_system.add_memory(
            content=conv,
            memory_type="conversation",
            tags=["重复", "日常"]
        )
        print(f"添加重复信息 {i+1}: {conv[:30]}... -> ID: {memory_id}")
        time.sleep(0.1)

def test_mixed_info(memory_system):
    """测试混合信息对话"""
    conversations = [
        "你好，我是新来的同事，叫李明。",  # 重要信息
        "今天天气真差，一直在下雨。",  # 闲聊
        "我的电话号码是138-1234-5678。",  # 重要信息
        "中午一起去吃饭吗？",  # 闲聊
        "我负责的项目 deadline 是下周五。"  # 重要信息
    ]
    
    for i, conv in enumerate(conversations):
        memory_id = memory_system.add_memory(
            content=conv,
            memory_type="conversation",
            tags=["混合", "日常"]
        )
        print(f"添加混合信息 {i+1}: {conv[:30]}... -> ID: {memory_id}")
        time.sleep(0.1)

def test_meaningless_info(memory_system):
    """测试无意义信息对话"""
    conversations = [
        "嗯...",
        "啊...",
        "哦...",
        "这个...",
        "那个..."
    ]
    
    for i, conv in enumerate(conversations):
        memory_id = memory_system.add_memory(
            content=conv,
            memory_type="conversation",
            tags=["无意义", "日常"]
        )
        print(f"添加无意义信息 {i+1}: {conv[:30]}... -> ID: {memory_id}")
        time.sleep(0.1)

def analyze_memory_results(memory_system):
    """分析记忆存储结果"""
    # 获取统计信息
    stats = memory_system.get_statistics()
    print(f"总记忆数: {stats['total_memories']}")
    print(f"记忆类型分布: {json.dumps(stats['memory_types'], ensure_ascii=False)}")
    print(f"标签分布: {json.dumps(stats['top_tags'], ensure_ascii=False)}")
    print(f"最常访问记忆: {json.dumps(stats['top_accessed_memories'], ensure_ascii=False)}")
    
    # 搜索不同类型的记忆
    print("\n=== 搜索测试 ===")
    
    # 搜索重要信息
    important_results = memory_system.search_memories(query="重要", limit=5)
    print(f"\n搜索'重要'结果 ({len(important_results)}):")
    for result in important_results:
        print(f"  - {result['content'][:50]}... (相似度: {result['similarity_score']:.2f})")
    
    # 搜索闲聊信息
    small_talk_results = memory_system.search_memories(query="闲聊", limit=5)
    print(f"\n搜索'闲聊'结果 ({len(small_talk_results)}):")
    for result in small_talk_results:
        print(f"  - {result['content'][:50]}... (相似度: {result['similarity_score']:.2f})")
    
    # 搜索无意义信息
    meaningless_results = memory_system.search_memories(query="无意义", limit=5)
    print(f"\n搜索'无意义'结果 ({len(meaningless_results)}):")
    for result in meaningless_results:
        print(f"  - {result['content'][:50]}... (相似度: {result['similarity_score']:.2f})")
    
    # 分析优化点
    print("\n=== 优化建议 ===")
    print("1. 实现对话内容过滤机制，过滤无意义信息")
    print("2. 增加记忆重要性评估，优先存储重要信息")
    print("3. 优化重复信息处理，避免存储高度相似的内容")
    print("4. 实现记忆自动清理机制，定期清理低价值记忆")
    print("5. 增加对话上下文理解，存储更有意义的信息单元")

if __name__ == "__main__":
    test_memory_system()
```

## 测试场景说明
1. **日常闲聊对话**：测试系统对日常闲聊的存储行为
2. **重要信息对话**：测试系统对重要信息的存储行为
3. **重复信息对话**：测试系统对重复信息的处理
4. **混合信息对话**：测试系统对混合重要性信息的处理
5. **无意义信息对话**：测试系统对无意义信息的存储行为

## 分析方法
1. 统计记忆存储数量和类型分布
2. 分析标签分布情况
3. 测试搜索不同类型信息的结果
4. 评估记忆系统的存储效率
5. 提出优化建议

## 预期结果
通过测试，我们可以观察到：
1. 记忆系统是否会存储所有对话内容
2. 重复信息的处理方式
3. 无意义信息的存储情况
4. 重要信息的检索效果
5. 可能的优化空间

## 优化方向
根据测试结果，我们可以考虑以下优化方向：
1. 实现对话内容过滤机制
2. 增加记忆重要性评估
3. 优化重复信息处理
4. 实现记忆自动清理机制
5. 改进对话上下文理解
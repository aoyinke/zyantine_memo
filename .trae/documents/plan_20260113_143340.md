# 精简核心阶段计划

## 目标
保留4个核心阶段（预处理、记忆检索、回复生成、协议审查），移除或可选化其他阶段，以提高系统响应速度和简化处理流程。

## 分析当前结构
当前处理管道包含10个阶段：
1. PREPROCESS - 预处理
2. INSTINCT_CHECK - 本能检查
3. MEMORY_RETRIEVAL - 记忆检索
4. DESIRE_UPDATE - 欲望更新
5. COGNITIVE_FLOW - 认知流程
6. DIALECTICAL_GROWTH - 辩证增长
7. REPLY_GENERATION - 回复生成
8. PROTOCOL_REVIEW - 协议审查
9. INTERACTION_RECORDING - 交互记录
10. WHITE_DOVE_CHECK - 白鸽检查

## 优化方案

### 1. 修改阶段依赖关系
- 更新 `stage_dependencies` 字典，移除对非核心阶段的依赖
- 修改 REPLY_GENERATION 阶段的依赖，从依赖 COGNITIVE_FLOW 和 MEMORY_RETRIEVAL 改为只依赖 MEMORY_RETRIEVAL
- 确保核心阶段之间的依赖关系正确

### 2. 更新快速路径处理
- 修改 `_execute_fast_path` 方法，只包含4个核心阶段
- 移除对 INSTINCT_CHECK 阶段的调用

### 3. 可选化其他阶段
- 保持其他阶段的定义，但在默认配置中设置为可选
- 确保系统在缺少这些阶段时能够正常工作

### 4. 更新系统核心初始化
- 修改 `_initialize_pipeline` 方法，根据配置选择性地注册非核心阶段
- 确保核心阶段始终被注册

### 5. 配置优化
- 在配置文件中添加选项，允许用户自定义启用哪些阶段
- 默认只启用4个核心阶段

## 技术实现步骤

1. **修改 ProcessingPipeline 类**
   - 更新 `stage_dependencies` 字典
   - 修改 `_execute_fast_path` 方法
   - 确保核心阶段的依赖关系正确

2. **修改 SystemCore 类**
   - 更新 `_initialize_pipeline` 方法
   - 根据配置选择性地注册阶段

3. **更新配置系统**
   - 在 ProcessingConfig 类中添加阶段启用选项
   - 默认只启用核心阶段

4. **测试和验证**
   - 确保系统在只启用核心阶段时能够正常工作
   - 验证响应速度是否有明显提升
   - 确保功能完整性不受影响

## 预期效果
- 响应时间显著减少
- 处理流程简化，易于理解和维护
- 系统资源利用率提高
- 保持核心功能的完整性